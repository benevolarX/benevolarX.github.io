<!DOCTYPE html><html lang="fr" class="astro-DK64E4A6">
	<head>
		<meta charset="UTF-8">
<meta name="description" property="og:description" content="Outil de rÃ©cupÃ©ration et validation d'ip client pour le back
">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Astro v1.2.4">
<title>get-ip-from-request</title>

<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;400;700;900&display=swap" rel="stylesheet">

		
	<link rel="stylesheet" href="/assets/331a2b55.ceac8769.css" />
<link rel="stylesheet" href="/assets/ff5792a7.87df5928.css" />
<link rel="stylesheet" href="/assets/index-project-b-css-project-get-ip-from-request-projects.aaf5fcb9.css" /></head>
	<body class="astro-DK64E4A6">
		<nav data-hk="0-0" class="_nav_ycrok_1"><a class="_logolink_ycrok_10" href="/"><div class="_monogram_ycrok_30">B</div></a><a class="_link_ycrok_16" href="/projects">Projets</a><a class="_link_ycrok_16" href="/blog">Blog</a><a class="_link_ycrok_16" href="/about">A propos</a><a class="_social_ycrok_47" href="https://github.com/benevolarX"><svg class="_socialicon_ycrok_55" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg></a></nav>
		<header style="background-image:url(https://images.unsplash.com/photo-1548391350-1a529f6ea42d?fit=crop&#38;w=1400&#38;h=700&#38;q=75)" class="hero astro-DK64E4A6">
			<h1 class="title astro-DK64E4A6">get-ip-from-request</h1>
		</header>
		<div class="leadIn astro-DK64E4A6">
			<div class="wrapper pt8 pb8 mb8 tac astro-DK64E4A6">
				<span class="tag astro-DK64E4A6">ip</span><span class="tag astro-DK64E4A6">back</span><span class="tag astro-DK64E4A6">unit-test</span><span class="tag astro-DK64E4A6">npm</span>
				<h3 class="tagline astro-DK64E4A6">Outil de rÃ©cupÃ©ration et validation d&#39;ip client pour le back
</h3>
			</div>
		</div>
		<div class="wrapper wrapper__readable astro-DK64E4A6">
			<div class="content astro-DK64E4A6"><p>Alors lÃ , on attaque un gros morceau.
Ne vous fiez pas au <a href="https://github.com/benevolarX/get-ip-from-request">repo github</a>, le projet a bel et bien Ã©tÃ© publiÃ© en 2020.
A la base, je travaillais sur un projet back et je souhaitais rÃ©cupÃ©rer lâ€™ip de lâ€™utilisateur ainsi que le numÃ©ro de version de son navigateur (User Agent) afin dâ€™avoir une emprunte numÃ©rique assez fiable pour lâ€™identifier sans que celui ci nâ€™ai besoin de crÃ©er un compte utilisateur.
Rapidement, je suis tombÃ© sur <a href="http://npm.im/request-ip">request-ip</a>.</p>
<p>En regardant le code (en version 2.1.3 Ã  lâ€™Ã©poque) jâ€™ai trouvÃ© un truc que jâ€™ai trouvÃ© dommage : une dÃ©pendance Ã  <a href="http://npm.im/is_js">is_js</a> en nâ€™important que la fonction permettant de tester lâ€™ip via une expression rÃ©guliÃ¨re.
ParallÃ¨lement, je suis aussi tombÃ© sur is-ip qui mâ€™a ensuite redirigÃ© sur <a href="http://npm.im/ip-regex">ip-regex</a>.
Câ€™est lâ€™un des gros points noirs de <a href="https://nodejs.org/fr/">node js</a> et ces paquets <a href="https://www.npmjs.com/">npm</a>.
Souvent les gens tÃ©lÃ©chargent une dÃ©pendance juste pour une fonction populaire au lieu de la crÃ©er eux mÃªme et si la dÃ©pendance part Ã  lâ€™abbandon et bien temps pi pour vous.</p>
<p>En mâ€™inspirant de ces deux lÃ , jâ€™ai crÃ©Ã© ma propre lib <a href="http://npm.im/get-ip-from-request">get-ip-from-request</a> (le nom est un peut long je sais) afin de rÃ©aliser la mÃªme tÃ¢che que request-ip MAIS avec une regex personnelle inspirÃ©e de ip-regex.
AprÃ¨s quelques tests (unitaires repris dâ€™autres libs de test dâ€™ip) jâ€™ai pu me rendre compte que ma version 0-dependancy Ã©tait plus rapide (jusquâ€™Ã  40% plus rapide pour lâ€™ip v4-v6 par rapport Ã  <a href="http://npm.im/is_js">is_js</a> qui Ã©tait utilisÃ© par <a href="http://npm.im/request-ip">request-ip</a>)
Jâ€™Ã©tais tout fier au moment oÃ¹ jâ€™ai publiÃ© mes rÃ©sultats surtout que jâ€™avais un <a href="https://www.amd.com/en/product/2041">ryzen 3 1300x</a> donc un processeur 4 coeurs; trÃ¨s loin de pouvoir rivaliser avec les processeurs de serveur web.</p>
<p>Jâ€™ai maintenu la lib Ã  jour, fait dâ€™autres tests (1 par an) puis il y a 2 mois, la version <a href="https://www.npmjs.com/package/request-ip/v/3.1.0">3.1.0</a> de <a href="http://npm.im/request-ip">request-ip</a> est apparue.
Et quelle mise Ã  jour ! La librairie Ã©tait devenue 0-dependancy !</p>
<p>Sans mâ€™en rendre compte, je venais de proposer pas moins de 2 ans AVANT la <a href="https://www.npmjs.com/package/request-ip/v/3.1.0">3.1.0</a> une amÃ©lioration dâ€™une librairy tÃ©lÃ©chargÃ©e plus de 500 000 fois par semaine !
VISIONNAIRE !</p>
<p>Bon. En thÃ©orie, jâ€™aurai pu me contenter dâ€™un simple pull request sur le projet principal mais Ã  la base, jâ€™ignorais la pertinance de mon idÃ©e.
Câ€™Ã©tait surtout un caprice de ma part de voir du code moche avec des micros dÃ©pendances de partout qui mâ€™a motivÃ©.</p>
<p>Aujourdâ€™hui il sâ€™agit de mon projet le plus tÃ©lÃ©chargÃ© (+4500 tÃ©lÃ©chargement au total) :p</p></div>
		</div>
		<footer class="tac mt6 astro-DK64E4A6">
			<a href="/projects" class="astro-DK64E4A6">
				<span data-hk="0-0" class="_button_1fbb5_1">Retour Ã  la liste des projets</span>
			</a>
		</footer>
		<footer data-hk="0-0" class="_footer_knfx6_1">Â© <!--#-->2022<!--/--> <a href="https://github.com/benevolarX">@benevolarX (auffret)</a><small class="_byline_knfx6_9">ğŸš€ gÃ©nÃ©rÃ© par Astro</small></footer>
	</body></html>